import{_ as C,u as w,r as A,o as a,c,b as t,e as g,g as v,t as r,h as p,q as u,v as D,f,F as b,a as S,d as y,w as I,p as N,j as q,i as x}from"./index-9fdc7868.js";import{_ as k}from"./userPic-2a6011f5.js";import{_ as M}from"./Spinner-1s-200px-2-0335de7c.js";const T={mixins:[w],watch:{$route(e,s){this.geo=null,this.map={selectedMode:"TRANSIT",origin:null},this.routes="",this.initMap(),this.getMemberId(),this.fetchDetails(),this.getEnroll(),this.getSave(),this.getQandA(),this.getSameCategory(),console.log("路由發生了變化：",e.path,s.path)}},data(){return{details:{},saveStatus:{},enrollStatus:{},QandA:[],sameCategory:[],map:{selectedMode:"TRANSIT",origin:null},memberId:0,isloading:!0,askContent:"",qerromsg:"",latitude:null,longitude:null,geo:null,routes:""}},created(){this.getMemberId(),this.fetchDetails(),this.getEnroll(),this.getSave(),this.getQandA(),this.getSameCategory()},mounted(){this.initMap()},methods:{async getMemberId(){let e=0,o={method:"GET",headers:{Authorization:`Bearer ${$.cookie("token")}`}};try{let l=await(await fetch("https://localhost:7259/api/Members/Read",o)).json();return console.log(l),e=l,this.memberId=e,e}catch{return console.log("未登入"),this.memberId=e,e}},async fetchDetails(){let e=this.$route.path.slice(10),o=await(await fetch("https://localhost:7259/api/Activity/Details/?activityId="+e)).json(),n=parseInt(o.categoryId);return this.details=o,n},async getLocation(){try{navigator.geolocation.getCurrentPosition(e=>{const s={lat:e.coords.latitude,lng:e.coords.longitude};this.geo=s,console.log(this.geo),this.map.origin="使用目前位置",this.initMap()})}catch{console.error("Geolocation is not supported by this browser.")}},initMap(){const e=new google.maps.DirectionsRenderer,s=new google.maps.DirectionsService,o=new google.maps.Map(document.getElementById("map"),{zoom:7,center:{lat:23.5,lng:121}});e.setMap(o),this.calculateAndDisplayRoute(s,e),document.getElementById("floating-panel").addEventListener("change",()=>{this.calculateAndDisplayRoute(s,e)})},calculateAndDisplayRoute(e,s){const o=this.details.address;let n=this.map.selectedMode,l=this.map.origin;this.geo!=null&&this.map.origin=="使用目前位置"&&(l=this.geo,console.log("使用目前位置")),e.route({origin:l,destination:o,travelMode:google.maps.TravelMode[n]}).then(d=>{s.setDirections(d);let m=d.routes[0].legs[0];console.log(m);let i=m.distance.text,_=m.duration.text;console.log(i,_),this.routes=`距離${i}，花費${_}`}).catch(d=>console.log("Directions request failed due to "+status))},async getEnroll(){this.isloading=!0;const s={memberId:await this.getMemberId(),activityId:this.$route.path.slice(10)};let n=await(await fetch("https://localhost:7259/api/ActivityEnroll/EnrollStatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();this.isloading=!1,console.log("報名狀態:",n),this.enrollStatus=n},async getSave(){const e={memberId:await this.getMemberId(),activityId:this.$route.path.slice(10)};let o=await(await fetch("https://localhost:7259/api/ActivitySave/SaveStatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log("Success:",o),this.saveStatus=o},async getQandA(){let e=this.$route.path.slice(10),o=await(await fetch("https://localhost:7259/api/ActivityQnA/Get/"+e)).json();this.QandA=o,console.log("問與答",o)},errmsg(){this.qerromsg=""},async getSameCategory(){let e=await this.fetchDetails(),o={memberId:await this.getMemberId(),categoryId:e,activityId:this.$route.path.slice(10)},l=await(await fetch("https://localhost:7259/api/Activity/SameCategory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();this.sameCategory=l,console.log("相同類別的活動",l)},save(e,s,o){e.stopPropagation();let n;e.target.tagName.toLowerCase()==="button"?n=e.target:e.target.tagName.toLowerCase()==="i"&&(n=e.currentTarget),n.innerHTML=`<i style=" font-size: 25px;
  color: #e9ca89;"
        class="fa-solid fa-bookmark"></i>`,console.log(s),fetch("https://localhost:7259/api/ActivitySave/Save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memberId:o,activityId:s})}).then(d=>d.json()).then(d=>{console.log("Success:",d),d.result?(this.saveStatus.statusId=4,this.saveStatus.unSaveId=d.activityCollectionId,this.showAlert(d.message)):this.showAlert(d.message)}).catch(d=>{console.error("Error:",d)})},unsave(e,s){e.stopPropagation();let o;e.target.tagName.toLowerCase()==="button"?o=e.target:e.target.tagName.toLowerCase()==="i"&&(o=e.currentTarget),console.log(o),o.innerHTML=`<i style=" font-size: 25px;
  color: #e9ca89;" class="fa-regular fa-bookmark"></>`,fetch("https://localhost:7259/api/ActivitySave/UnSave/"+s,{method:"Delete"}).then(n=>n.json()).then(n=>{console.log("Success:",n),n.result?(this.saveStatus.statusId=3,this.saveStatus.unSaveId=0,this.showAlert(n.message)):this.showAlert(n.message)}).catch(n=>{console.error("Error:",n)})},ask(){let e=this.askContent;if(this.qerromsg="",e==null||e.length==0||e.trim().length<1){this.qerromsg="請輸入內容";return}const s={memberId:this.memberId,activityId:this.details.activityId,content:this.askContent};console.log(s),this.askContent="",fetch("https://localhost:7259/api/ActivityQnA/Ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(o=>o.json()).then(o=>{console.log(o),this.QandA.push({nickName:o.nickName,photoSticker:o.photoSticker,activityId:o.activityId,qId:o.qId,qContent:o.qContent,qDateCreated:o.qDateCreated,memberId:this.memberId,aId:null,aContent:null,aDateCreated:null}),this.showAlert(o.message)})},deleteQ(e,s){this.$swal.fire({text:"確定刪除發問？",showCancelButton:!0,width:"220px",focusCancel:!0}).then(o=>{o.isConfirmed&&fetch("https://localhost:7259/api/ActivityQnA/DeleteQ/"+e,{method:"Delete"}).then(n=>n.json()).then(n=>{n.result?(console.log("Success:",n),this.QandA.splice(s,1),this.showAlert(n.message)):this.showAlert(n.message)}).catch(n=>{console.error("Error:",n)})})},enroll(e){let s={memberId:this.memberId,activityId:this.$route.path.slice(10)};this.$swal.fire({text:"確定報名？",showCancelButton:!0,width:"220px",focusConfirm:!1}).then(o=>{o.isConfirmed&&fetch("https://localhost:7259/api/ActivtiyEnroll/Enroll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(n=>n.json()).then(n=>{console.log("Success:",n),n.result?(this.enrollStatus.statusId=5,this.enrollStatus.deleteId=n.deleteId,this.showAlert(n.message)):this.showAlert(n.message)}).catch(n=>{console.error("Error:",n)})})},unenroll(e){this.$swal.fire({text:"取消報名？",showCancelButton:!0,width:"220px",focusCancel:!0}).then(s=>{s.isConfirmed&&fetch("https://localhost:7259/api/ActivtiyEnroll/CancelEnroll/"+e,{method:"Delete"}).then(o=>o.json()).then(o=>{console.log("Success:",o),o.result?(this.enrollStatus.statusId=4,this.enrollStatus.deleteId=0,this.showAlert(o.message)):this.showAlert(o.message)}).catch(o=>{console.error("Error:",o)})})}}},h=e=>(N("data-v-56b95020"),e=e(),q(),e),j={class:"container"},B={class:"detailpage"},Q={class:"row justify-content-center m-4"},E={class:"col-12 col-md-6",id:"activityimg"},L=["src"],P={class:"col-12 col-md-6",id:"activityinfo"},O={class:"activityName"},R={id:"destination"},V={class:"buttonList mt-2"},G={key:0,class:"saveBtn1",disabled:""},J=h(()=>t("i",{class:"fa-regular fa-bookmark"},null,-1)),z=[J],U=h(()=>t("i",{class:"fa-regular fa-bookmark"},null,-1)),F=[U],H={key:2,"data-bs-toggle":"modal","data-bs-target":"#loginModal",type:"button",class:"saveBtn1"},K=h(()=>t("i",{class:"fa-regular fa-bookmark"},null,-1)),W=[K],Y=["deleteId"],X=h(()=>t("i",{class:"fa-solid fa-bookmark"},null,-1)),Z=[X],tt={key:4,class:"enrollBtn1",disabled:""},et={key:5,class:"enrollBtn1",disabled:""},st={key:6,"data-bs-toggle":"modal","data-bs-target":"#loginModal",type:"button",class:"enrollBtn1"},ot=["deleteId"],it={class:"row justify-content-center m-4"},lt={class:"col-12 col-md-6"},nt=h(()=>t("h5",null,"活動說明",-1)),at={id:"description",class:"description"},ct={class:"col-12 col-md-6"},rt=h(()=>t("h5",null,"講師資訊",-1)),dt={id:"instructorCard",class:"d-flex justify-content-center align-items-center"},ht={class:"instructorCard"},ut={class:"instructorPhoto d-flex justify-content-center align-items-center"},mt=["src"],_t={class:"instructorInfo d-flex flex-column justify-content-around align-items-center"},gt={class:"instrutorName"},pt={class:"instructorDes"},vt={class:"row justify-content-center m-4"},yt={class:"col"},It=h(()=>t("h5",null,"查看路線",-1)),ft={class:"panel",id:"floating-panel"},bt=h(()=>t("label",{for:"mode"},"交通方式： ",-1)),St=x('<option value="" selected disabled data-v-56b95020>選擇交通方式</option><option value="DRIVING" data-v-56b95020>開車</option><option value="WALKING" data-v-56b95020>走路</option><option value="BICYCLING" data-v-56b95020>腳踏車</option><option value="TRANSIT" data-v-56b95020>大眾運輸</option>',5),kt=[St],Ct=h(()=>t("div",{id:"map"},null,-1)),wt={class:"row justify-content-center m-4"},At={class:"col"},Dt=h(()=>t("h5",null,"問與答",-1)),Nt={key:0},qt=["qid"],xt={key:0,class:"QAlist"},Mt={class:"question"},Tt={class:"user d-flex align-items-center"},jt=["src"],Bt={key:1,class:"quser",src:k,alt:""},Qt={class:"ms-4"},Et={class:"qcontent"},Lt={class:"date"},Pt={key:0,class:"answer mt-3"},Ot={class:"acontent"},Rt={class:"date"},Vt={key:1,class:"myQAlist"},Gt={class:"myquestion"},Jt={class:"user d-flex align-items-center"},zt=["src"],Ut={key:1,class:"quser",src:k,alt:""},Ft={class:"ms-4"},Ht=["onClick"],Kt=h(()=>t("i",{class:"fa-solid fa-trash"},null,-1)),Wt=[Kt],Yt={class:"myqcontent"},Xt={class:"date"},Zt={key:0,class:"myanswer mt-3"},$t={class:"myacontent"},te={class:"date"},ee={class:"askInput d-flex mt-4"},se={key:1,"data-bs-toggle":"modal","data-bs-target":"#loginModal",class:"askBtn",id:"ask"},oe={class:"qerromsg"},ie={class:"row justify-content-center m-4"},le={key:0,class:"col",id:"sameCategory"},ne=h(()=>t("div",null,[t("h5",null,"同類型推薦")],-1)),ae={class:"row",id:"sameCategoryCard"},ce={class:"sameList"},re=["src"],de={class:"sameInfo"},he={class:"activityName"},ue={class:"samedate"},me=h(()=>t("i",{class:"fa-solid fa-calendar-days"},null,-1)),_e={class:"ellipsis"},ge={class:"image-container"},pe=h(()=>t("img",{src:M,alt:""},null,-1)),ve=[pe],ye={key:0};function Ie(e,s,o,n,l,d){const m=A("router-link");return a(),c("div",j,[t("div",B,[g(t("div",null,[t("div",Q,[t("div",E,[t("img",{class:"coverImage",src:l.details.coverImage,alt:""},null,8,L)]),t("div",P,[t("p",O,r(l.details.activityName),1),t("p",null,"拍攝類型："+r(l.details.categoryName),1),t("p",null,"建議器材："+r(l.details.recommendation),1),t("p",null,"活動時間："+r(l.details.gatheringTime),1),t("p",null,[p(" 集合地點："),t("span",R,r(l.details.address),1)]),t("p",null," 活動名額："+r(l.details.memberLimit)+"人 || 剩餘"+r(l.details.memberLimit-l.details.numOfEnrolment)+"人 ",1),t("p",null,"報名截止日："+r(l.details.deadline),1),t("div",V,[this.saveStatus.statusId==2?(a(),c("button",G,z)):this.saveStatus.statusId==3&&this.memberId!=0?(a(),c("button",{key:1,onClick:s[0]||(s[0]=i=>d.save(i,this.saveStatus.activityId,this.memberId)),class:"saveBtn"},F)):this.saveStatus.statusId==3&&this.memberId==0?(a(),c("button",H,W)):this.saveStatus.statusId==4||this.saveStatus.statusId==5?(a(),c("button",{key:3,onClick:s[1]||(s[1]=i=>d.unsave(i,l.saveStatus.unSaveId)),type:"button",class:"unsaveBtn",deleteId:l.saveStatus.unSaveId},Z,8,Y)):u("",!0),this.enrollStatus.statusId==2?(a(),c("button",tt," 報名已截止 ")):this.enrollStatus.statusId==3?(a(),c("button",et," 已額滿 ")):this.enrollStatus.statusId==4&&this.memberId==0?(a(),c("button",st," 報名活動 ")):this.enrollStatus.statusId==4&&this.memberId!=0?(a(),c("button",{key:7,type:"button",class:"enrollBtn",onClick:s[2]||(s[2]=i=>d.enroll(i))}," 報名活動 ")):this.enrollStatus.statusId==5?(a(),c("button",{key:8,type:"button",class:"unenrollBtn",deleteId:this.enrollStatus.deleteId,onClick:s[3]||(s[3]=i=>d.unenroll(this.enrollStatus.deleteId))}," 取消報名（已報名） ",8,ot)):u("",!0)])])]),t("div",it,[t("div",lt,[nt,t("div",at,r(l.details.activityDescription),1)]),t("div",ct,[rt,t("div",dt,[t("div",ht,[t("div",ut,[t("img",{src:l.details.resumePhoto,alt:"",referrerpolicy:"no-referrer"},null,8,mt)]),t("div",_t,[t("p",gt,r(l.details.instructorName),1),t("p",pt,r(l.details.instructorDescription),1)])])])])]),t("div",vt,[t("div",yt,[It,t("div",ft,[bt,g(t("select",{"onUpdate:modelValue":s[4]||(s[4]=i=>l.map.selectedMode=i),id:"mode",class:"mode"},kt,512),[[D,l.map.selectedMode]]),g(t("input",{placeholder:"輸入出發地點...","onUpdate:modelValue":s[5]||(s[5]=i=>l.map.origin=i),type:"text",id:"origin",class:"origin",autocomplete:"off"},null,512),[[f,l.map.origin]]),t("button",{class:"geoBtn",onClick:s[6]||(s[6]=(...i)=>d.getLocation&&d.getLocation(...i)),id:"geo"}," 使用目前位置 ")]),g(t("div",{class:"routes"},r(l.routes),513),[[v,l.routes!=""]]),Ct])]),t("div",wt,[t("div",At,[Dt,l.QandA.length>0?(a(),c("div",Nt,[(a(!0),c(b,null,S(l.QandA,(i,_)=>(a(),c("div",{key:_,qid:l.QandA.QId,class:"QandA",id:"question"},[i.memberId!=this.memberId?(a(),c("div",xt,[t("div",null,[t("div",Mt,[t("div",Tt,[y(m,{class:"d-flex align-items-center",to:"/Community/PersonalPage/"+i.memberId+"/Photos/"},{default:I(()=>[i.photoSticker?(a(),c("img",{key:0,class:"quser",src:"https://localhost:7259/Images/"+i.photoSticker,alt:""},null,8,jt)):(a(),c("img",Bt)),t("p",Qt,r(i.nickName),1)]),_:2},1032,["to"])]),t("div",Et,[t("p",null,r(i.qContent),1)]),t("div",Lt,r(i.qDateCreated),1)])]),i.aId!=null?(a(),c("div",Pt,[p(" 回覆 "),t("div",Ot,[t("p",null,r(i.aContent),1)]),t("div",Rt,r(i.aDateCreated),1)])):u("",!0)])):i.memberId==this.memberId?(a(),c("div",Vt,[t("div",null,[t("div",null,[t("div",Gt,[t("div",Jt,[y(m,{class:"d-flex align-items-center",to:"/Community/PersonalPage/"+i.memberId+"/Photos/"},{default:I(()=>[i.photoSticker?(a(),c("img",{key:0,class:"quser",src:"https://localhost:7259/Images/"+i.photoSticker,alt:""},null,8,zt)):(a(),c("img",Ut)),t("p",Ft,r(i.nickName),1)]),_:2},1032,["to"]),t("button",{onClick:fe=>d.deleteQ(i.qId,_),class:"deleteQcontent"},Wt,8,Ht)]),t("div",Yt,[t("p",null,r(i.qContent),1)]),t("div",Xt,r(i.qDateCreated),1)])])]),i.aId!=null?(a(),c("div",Zt,[p(" 回覆 "),t("div",$t,[t("p",null,r(i.aContent),1)]),t("div",te,r(i.aDateCreated),1)])):u("",!0)])):u("",!0)],8,qt))),128))])):u("",!0),t("div",ee,[g(t("textarea",{"onUpdate:modelValue":s[7]||(s[7]=i=>l.askContent=i),onKeydown:s[8]||(s[8]=(...i)=>d.errmsg&&d.errmsg(...i)),name:"content",id:"askcontent",class:"askContent",maxlength:"300",placeholder:"提出和此活動有關的問題！"},null,544),[[f,l.askContent]]),this.memberId!=0?(a(),c("button",{key:0,onClick:s[9]||(s[9]=(...i)=>d.ask&&d.ask(...i)),class:"askBtn",id:"ask"}," 發問 ")):(a(),c("button",se," 發問 "))]),t("p",oe,r(l.qerromsg),1)])]),t("div",ie,[l.sameCategory.length>0?(a(),c("div",le,[ne,t("div",ae,[(a(!0),c(b,null,S(l.sameCategory,(i,_)=>(a(),c("div",{key:_,class:"col-12 col-md-6"},[y(m,{to:"/Activity/"+i.activityId,class:"sameLink"},{default:I(()=>[t("div",ce,[t("div",null,[t("img",{class:"sameImg",src:i.coverImage,alt:"活動封面圖"},null,8,re)]),t("div",de,[t("p",he,r(i.activityName),1),t("p",ue,[me,p(r(i.gatheringTime),1)]),t("p",_e,r(i.description.slice(0,8))+"...",1)])])]),_:2},1032,["to"])]))),128))])])):u("",!0)])],512),[[v,!l.isloading&&l.details.activityName!=null]]),g(t("div",ge,ve,512),[[v,l.isloading]]),!l.isloading&&l.details.activityName==null?(a(),c("div",ye,"沒有此活動")):u("",!0)])])}const Ce=C(T,[["render",Ie],["__scopeId","data-v-56b95020"]]);export{Ce as default};
