import{_ as k,u as C,r as w,o as r,c as u,b as s,e as h,f as g,I as N,v as _,F as f,a as b,h as I,g as y,t as m,d as S,w as D,q as A,p as T,j as M,i as x}from"./index-9fdc7868.js";import{_ as B}from"./Spinner-1s-200px-2-0335de7c.js";const E={mixins:[C],data(){return{input:{activityName:"",categoryId:0,address:"",time:new Date,memberId:0},result:[],minDate:new Date,categoryOption:[],isloading:!0,isempty:!0}},mounted(){this.getMemberId(),this.getCategory(),this.setTime(),this.fetchActivityData(),this.$nextTick(()=>{this.result.forEach(e=>{this.$el.querySelector(".addressTag").addEventListener("click",()=>{this.Citytag(e)})})}),this.$nextTick(()=>{this.result.forEach(e=>{this.$el.querySelector(".categoryTag").addEventListener("click",()=>{this.Categorytag(e)})})})},methods:{async fetchActivityData(){this.isloading=!0,this.isempty=!1;let e=await this.getMemberId(),t={activityName:this.input.activityName,categoryId:this.input.categoryId,address:this.input.address,time:this.input.time,memberId:e};console.log(t);let a="https://localhost:7259/api/Activity/Search?";t.activityName!==""&&(a+=`activityName=${t.activityName}&`),t.categoryId!==0&&(a+=`categoryId=${t.categoryId}&`),t.address!==""&&(a+=`address=${t.address}&`),a+=`time=${t.time}&`,a+=`memberId=${t.memberId}`,console.log(a),this.isempty=!1;const i=await(await fetch(a)).json();this.isloading=!1,this.result=i,i.length==0&&(this.isempty=!0)},setTime(){let e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),min:e.getMinutes()};t.month<10&&(t.month=`0${t.month}`),t.day<10&&(t.day=`0${t.day}`),t.hour<10&&(t.hour=`0${t.hour}`),t.min<10&&(t.min=`0${t.min}`);let a=`${t.year}-${t.month}-${t.day}T${t.hour}:${t.min}`;this.input.time=a,this.minDate=a},Citytag(e){this.input.address=e,this.input.activityName="",this.input.categoryId=0,this.setTime(),this.fetchActivityData()},Categorytag(e){this.input.address="",this.input.activityName="",this.input.categoryId=e,this.setTime(),this.fetchActivityData()},async getMemberId(){let e=0,a={method:"GET",headers:{Authorization:`Bearer ${$.cookie("token")}`}};try{let i=await(await fetch("https://localhost:7259/api/Members/Read",a)).json();return console.log(i),e=i,this.input.memberId=e,e}catch{return console.log("未登入"),this.input.memberId=e,e}},async getCategory(){let t=await(await fetch("https://localhost:7259/api/Activity/Category")).json();this.categoryOption=t},save(e,t,a,d){e.stopPropagation();let i;e.target.tagName.toLowerCase()==="button"?i=e.target:e.target.tagName.toLowerCase()==="i"&&(i=e.currentTarget),this.result[t].numOfCollections++,i.innerHTML=`<i style="width: 16px;
        color: #444;
        margin-right: 10px;"
        class="fa-solid fa-bookmark"></i>`,fetch("https://localhost:7259/api/ActivitySave/Save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memberId:d,activityId:a})}).then(l=>l.json()).then(l=>{console.log("Success:",l),l.result?(this.result[t].statusId=4,this.result[t].unSaveId=l.activityCollectionId,this.showAlert(l.message)):this.showAlert(l.message)}).catch(l=>{console.error("Error:",l)})},unsave(e,t,a){e.stopPropagation(),this.result[t].numOfCollections--;let d;e.target.tagName.toLowerCase()==="button"?d=e.target:e.target.tagName.toLowerCase()==="i"&&(d=e.currentTarget),d.innerHTML=`<i style="width: 16px;color: #444444;margin-right: 10px;" 
                                class="fa-regular fa-bookmark"></>`,fetch("https://localhost:7259/api/ActivitySave/UnSave/"+a,{method:"Delete"}).then(i=>i.json()).then(i=>{console.log("Success:",i),i.result?(this.result[t].statusId=3,this.result[t].unSaveId=0,this.showAlert(i.message)):this.showAlert(i.message)}).catch(i=>{console.error("Error:",i)})}}},c=e=>(T("data-v-980bd474"),e=e(),M(),e),L={class:"container"},O={class:"searchPage"},V=c(()=>s("h4",{class:"align-self-center mt-4"},"活動總覽",-1)),j={class:"row inputSearch"},P={class:"col-lg-3 col-md-4 col-12"},q={class:"col-lg-2 col-md-4 col-6"},U=c(()=>s("option",{value:"",disabled:""},"選擇拍攝類型",-1)),F=c(()=>s("option",{value:"0"},"所有拍攝類型",-1)),H=["value"],K={class:"col-lg-2 col-md-4 col-6"},z=x('<option disabled data-v-980bd474>選擇地區</option><option value="" selected data-v-980bd474>所有地區</option><option value="基隆市" data-v-980bd474>基隆市</option><option value="台北市" data-v-980bd474>台北市</option><option value="新北市" data-v-980bd474>新北市</option><option value="桃園市" data-v-980bd474>桃園市</option><option value="新竹市" data-v-980bd474>新竹市</option><option value="新竹縣" data-v-980bd474>新竹縣</option><option value="苗栗縣" data-v-980bd474>苗栗線</option><option value="台中市" data-v-980bd474>台中市</option><option value="彰化縣" data-v-980bd474>彰化縣</option><option value="南投縣" data-v-980bd474>南投縣</option><option value="雲林縣" data-v-980bd474>雲林縣</option><option value="嘉義市" data-v-980bd474>嘉義市</option><option value="嘉義縣" data-v-980bd474>嘉義縣</option><option value="台南市" data-v-980bd474>台南市</option><option value="高雄市" data-v-980bd474>高雄市</option><option value="屏東縣" data-v-980bd474>屏東縣</option><option value="宜蘭縣" data-v-980bd474>宜蘭縣</option><option value="花蓮縣" data-v-980bd474>花蓮縣</option><option value="台東縣" data-v-980bd474>台東縣</option><option value="澎湖縣" data-v-980bd474>澎湖縣</option><option value="金門縣" data-v-980bd474>金門縣</option><option value="連江縣" data-v-980bd474>連江縣</option>',24),G=[z],J={class:"col-lg-5 col-md-12 col-12"},R=["min"],Y={class:"row",id:"resultCard"},Q=["activityId"],W={class:"card-header"},X=["src"],Z={class:"card-body"},tt=c(()=>s("i",{class:"fa-solid fa-calendar-days"},null,-1)),et=c(()=>s("i",{class:"fa-solid fa-map-pin"},null,-1)),ot=["onClick","city"],st={class:"tag"},it=["onClick","categoryId"],at={class:"info"},nt={class:"enroll"},lt=c(()=>s("i",{class:"fa-solid fa-user"},null,-1)),ct={class:"num"},dt={class:"save"},rt=["activityId"],ut=c(()=>s("i",{class:"fa-regular fa-bookmark"},null,-1)),ht=[ut],mt=["onClick"],pt=c(()=>s("i",{class:"fa-regular fa-bookmark"},null,-1)),vt=[pt],yt=["onClick"],gt=c(()=>s("i",{class:"fa-solid fa-bookmark"},null,-1)),_t=[gt],ft={class:"num"},bt={class:"nothingPage"},It={class:"image-container"},kt=c(()=>s("img",{src:B,alt:""},null,-1)),Ct=[kt];function wt(e,t,a,d,i,n){const l=w("router-link");return r(),u("div",L,[s("div",O,[V,s("form",j,[s("div",P,[h(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.input.activityName=o),onKeydown:t[1]||(t[1]=N((...o)=>n.fetchActivityData&&n.fetchActivityData(...o),["enter"])),class:"inputName",name:"activityName",id:"activityName",type:"text",placeholder:"輸入活動名稱關鍵字...",autocomplete:"off"},null,544),[[g,i.input.activityName]])]),s("div",q,[h(s("select",{onChange:t[2]||(t[2]=(...o)=>n.fetchActivityData&&n.fetchActivityData(...o)),"onUpdate:modelValue":t[3]||(t[3]=o=>i.input.categoryId=o),class:"inputCategory",name:"categoryId",id:"categoryId"},[U,F,(r(!0),u(f,null,b(i.categoryOption,o=>(r(),u("option",{key:o.categoryName,value:o.id},m(o.categoryName),9,H))),128))],544),[[_,i.input.categoryId]])]),s("div",K,[h(s("select",{onChange:t[4]||(t[4]=(...o)=>n.fetchActivityData&&n.fetchActivityData(...o)),"onUpdate:modelValue":t[5]||(t[5]=o=>i.input.address=o),class:"inputAddress",name:"address",id:"adress"},G,544),[[_,i.input.address]])]),s("div",J,[h(s("input",{onChange:t[6]||(t[6]=(...o)=>n.fetchActivityData&&n.fetchActivityData(...o)),"onUpdate:modelValue":t[7]||(t[7]=o=>i.input.time=o),min:i.minDate,class:"inputTime",name:"time",type:"datetime-local",id:"inputTime"},null,40,R),[[g,i.input.time]]),I(" 之後的活動 ")])]),h(s("div",Y,[(r(!0),u(f,null,b(i.result,(o,v)=>(r(),u("div",{key:v,class:"col-12 col-sm-6 col-md-4 col-xl-3"},[s("div",{class:"card",activityId:o.activityId},[s("div",W,[S(l,{to:"/Activity/"+o.activityId},{default:D(()=>[s("img",{src:o.coverImage,alt:"cover"},null,8,X)]),_:2},1032,["to"])]),s("div",Z,[s("h5",null,m(o.activityName),1),s("p",null,[tt,I(m(o.gatheringTime),1)]),s("p",null,[et,s("a",{onClick:p=>n.Citytag(o.city),class:"addressTag",city:o.city},m(o.city),9,ot)]),s("span",st,[s("a",{onClick:p=>n.Categorytag(o.categoryId),class:"categoryTag",categoryId:o.categoryId},m(o.categoryName),9,it)])]),s("div",at,[s("div",nt,[lt,s("p",ct,m(o.numOfEnrolment),1)]),s("div",dt,[this.input.memberId==0?(r(),u("button",{key:0,"data-bs-toggle":"modal","data-bs-target":"#loginModal",type:"button",class:"saveBtn1",activityId:o.activityId},ht,8,rt)):o.statusId==3&&this.input.memberId!=0?(r(),u("button",{key:1,onClick:p=>n.save(p,v,o.activityId,this.input.memberId),type:"button",class:"saveBtn"},vt,8,mt)):o.statusId==4&&this.input.memberId!=0?(r(),u("button",{key:2,onClick:p=>n.unsave(p,v,o.unSaveId),type:"button",class:"unsaveBtn"},_t,8,yt)):A("",!0),s("p",ft,m(o.numOfCollections),1)])])],8,Q)]))),128))],512),[[y,!i.isempty&&!i.isloading]]),h(s("div",bt,"找不到符合的資料",512),[[y,i.isempty]]),h(s("div",It,Ct,512),[[y,i.isloading]])])])}const Dt=k(E,[["render",wt],["__scopeId","data-v-980bd474"]]);export{Dt as default};
