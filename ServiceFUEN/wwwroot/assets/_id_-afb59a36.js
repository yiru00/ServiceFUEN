import{_ as S,u as k,r as C,o as a,c,b as t,w as _,C as v,t as r,h as p,H as u,B as w,v as y,F as f,d as I,a as A,g as D,p as N,f as q,e as M}from"./index-c008cf96.js";import{_ as b}from"./userPic-2a6011f5.js";import{_ as T}from"./Spinner-1s-200px-2-0335de7c.js";const x={mixins:[k],watch:{$route(e,s){this.geo=null,this.map={selectedMode:"TRANSIT",origin:null},this.routes="",this.initMap(),this.getMemberId(),this.fetchDetails(),this.getEnroll(),this.getSave(),this.getQandA(),this.getSameCategory(),console.log("路由發生了變化：",e.path,s.path)}},data(){return{details:{},saveStatus:{},enrollStatus:{},QandA:[],sameCategory:[],map:{selectedMode:"TRANSIT",origin:null},memberId:0,isloading:!0,askContent:"",qerromsg:"",latitude:null,longitude:null,geo:null,routes:""}},created(){this.getMemberId(),this.fetchDetails(),this.getEnroll(),this.getSave(),this.getQandA(),this.getSameCategory()},mounted(){this.initMap()},methods:{async getMemberId(){let e=0,o={method:"GET",headers:{Authorization:`Bearer ${$.cookie("token")}`}};try{let n=await(await fetch("https://localhost:7259/api/Members/Read",o)).json();return console.log(n),e=n,this.memberId=e,e}catch{return console.log("未登入"),this.memberId=e,e}},async fetchDetails(){let e=this.$route.path.slice(10),o=await(await fetch("https://localhost:7259/api/Activity/Details/?activityId="+e)).json(),l=parseInt(o.categoryId);return this.details=o,l},async getLocation(){try{navigator.geolocation.getCurrentPosition(e=>{const s={lat:e.coords.latitude,lng:e.coords.longitude};this.geo=s,console.log(this.geo),this.map.origin="使用目前位置",this.initMap()})}catch{console.error("Geolocation is not supported by this browser.")}},initMap(){const e=new google.maps.DirectionsRenderer,s=new google.maps.DirectionsService,o=new google.maps.Map(document.getElementById("map"),{zoom:7,center:{lat:23.5,lng:121}});e.setMap(o),this.calculateAndDisplayRoute(s,e),document.getElementById("floating-panel").addEventListener("change",()=>{this.calculateAndDisplayRoute(s,e)})},calculateAndDisplayRoute(e,s){const o=this.details.address;let l=this.map.selectedMode,n=this.map.origin;this.geo!=null&&this.map.origin=="使用目前位置"&&(n=this.geo,console.log("使用目前位置")),e.route({origin:n,destination:o,travelMode:google.maps.TravelMode[l]}).then(d=>{s.setDirections(d);let g=d.routes[0].legs[0];console.log(g);let i=g.distance.text,m=g.duration.text;console.log(i,m),this.routes=`距離${i}，花費${m}`}).catch(d=>console.log("Directions request failed due to "+status))},async getEnroll(){this.isloading=!0;const s={memberId:await this.getMemberId(),activityId:this.$route.path.slice(10)};let l=await(await fetch("https://localhost:7259/api/ActivityEnroll/EnrollStatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();this.isloading=!1,console.log("報名狀態:",l),this.enrollStatus=l},async getSave(){const e={memberId:await this.getMemberId(),activityId:this.$route.path.slice(10)};let o=await(await fetch("https://localhost:7259/api/ActivitySave/SaveStatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log("Success:",o),this.saveStatus=o},async getQandA(){let e=this.$route.path.slice(10),o=await(await fetch("https://localhost:7259/api/ActivityQnA/Get/"+e)).json();this.QandA=o,console.log("問與答",o)},errmsg(){this.qerromsg=""},async getSameCategory(){let e=await this.fetchDetails(),o={memberId:await this.getMemberId(),categoryId:e,activityId:this.$route.path.slice(10)},n=await(await fetch("https://localhost:7259/api/Activity/SameCategory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();this.sameCategory=n,console.log("相同類別的活動",n)},save(e,s,o){e.stopPropagation();let l;e.target.tagName.toLowerCase()==="button"?l=e.target:e.target.tagName.toLowerCase()==="i"&&(l=e.currentTarget),l.innerHTML=`<i style=" font-size: 25px;
  color: #e9ca89;"
        class="fa-solid fa-bookmark"></i>`,console.log(s),fetch("https://localhost:7259/api/ActivitySave/Save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memberId:o,activityId:s})}).then(d=>d.json()).then(d=>{console.log("Success:",d),d.result?(this.saveStatus.statusId=4,this.saveStatus.unSaveId=d.activityCollectionId,this.showAlert(d.message)):this.showAlert(d.message)}).catch(d=>{console.error("Error:",d)})},unsave(e,s){e.stopPropagation();let o;e.target.tagName.toLowerCase()==="button"?o=e.target:e.target.tagName.toLowerCase()==="i"&&(o=e.currentTarget),console.log(o),o.innerHTML=`<i style=" font-size: 25px;
  color: #e9ca89;" class="fa-regular fa-bookmark"></>`,fetch("https://localhost:7259/api/ActivitySave/UnSave/"+s,{method:"Delete"}).then(l=>l.json()).then(l=>{console.log("Success:",l),l.result?(this.saveStatus.statusId=3,this.saveStatus.unSaveId=0,this.showAlert(l.message)):this.showAlert(l.message)}).catch(l=>{console.error("Error:",l)})},ask(){let e=this.askContent;if(this.qerromsg="",e==null||e.length==0||e.trim().length<1){this.qerromsg="請輸入內容";return}const s={memberId:this.memberId,activityId:this.details.activityId,content:this.askContent};console.log(s),this.askContent="",fetch("https://localhost:7259/api/ActivityQnA/Ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(o=>o.json()).then(o=>{console.log(o),this.QandA.push({nickName:o.nickName,photoSticker:o.photoSticker,activityId:o.activityId,qId:o.qId,qContent:o.qContent,qDateCreated:o.qDateCreated,memberId:this.memberId,aId:null,aContent:null,aDateCreated:null}),this.showAlert(o.message)})},deleteQ(e,s){this.$swal.fire({text:"確定刪除發問？",showCancelButton:!0,width:"220px",focusCancel:!0}).then(o=>{o.isConfirmed&&fetch("https://localhost:7259/api/ActivityQnA/DeleteQ/"+e,{method:"Delete"}).then(l=>l.json()).then(l=>{l.result?(console.log("Success:",l),this.QandA.splice(s,1),this.showAlert(l.message)):this.showAlert(l.message)}).catch(l=>{console.error("Error:",l)})})},enroll(e){let s={memberId:this.memberId,activityId:this.$route.path.slice(10)};this.$swal.fire({text:"確定報名？",showCancelButton:!0,width:"220px",focusConfirm:!1}).then(o=>{o.isConfirmed&&fetch("https://localhost:7259/api/ActivtiyEnroll/Enroll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(l=>l.json()).then(l=>{console.log("Success:",l),l.result?(this.enrollStatus.statusId=5,this.enrollStatus.deleteId=l.deleteId,this.showAlert(l.message)):this.showAlert(l.message)}).catch(l=>{console.error("Error:",l)})})},unenroll(e){this.$swal.fire({text:"取消報名？",showCancelButton:!0,width:"220px",focusCancel:!0}).then(s=>{s.isConfirmed&&fetch("https://localhost:7259/api/ActivtiyEnroll/CancelEnroll/"+e,{method:"Delete"}).then(o=>o.json()).then(o=>{console.log("Success:",o),o.result?(this.enrollStatus.statusId=4,this.enrollStatus.deleteId=0,this.showAlert(o.message)):this.showAlert(o.message)}).catch(o=>{console.error("Error:",o)})})}}},h=e=>(N("data-v-dfda23d7"),e=e(),q(),e),j={class:"container"},B={class:"detailpage"},Q={class:"row justify-content-center m-4"},E={class:"col-12 col-md-6",id:"activityimg"},L=["src"],O={class:"col-12 col-md-6",id:"activityinfo"},P={class:"activityName"},R={id:"destination"},V={class:"buttonList mt-2"},G={key:0,class:"saveBtn1",disabled:""},J=h(()=>t("i",{class:"fa-regular fa-bookmark"},null,-1)),z=[J],U=h(()=>t("i",{class:"fa-regular fa-bookmark"},null,-1)),H=[U],F={key:2,"data-bs-toggle":"modal","data-bs-target":"#loginModal",type:"button",class:"saveBtn1"},K=h(()=>t("i",{class:"fa-regular fa-bookmark"},null,-1)),W=[K],Y=["deleteId"],X=h(()=>t("i",{class:"fa-solid fa-bookmark"},null,-1)),Z=[X],tt={key:4,class:"enrollBtn1",disabled:""},et={key:5,class:"enrollBtn1",disabled:""},st={key:6,"data-bs-toggle":"modal","data-bs-target":"#loginModal",type:"button",class:"enrollBtn1"},ot=["deleteId"],it={class:"row justify-content-center m-4"},nt={class:"col-12 col-md-6"},lt=h(()=>t("h5",null,"活動說明",-1)),at={id:"description"},ct={class:"col-12 col-md-6"},rt=h(()=>t("h5",null,"講師資訊",-1)),dt={id:"instructorCard",class:"d-flex justify-content-center align-items-center"},ht={class:"instructorCard"},ut={class:"instructorPhoto d-flex justify-content-center align-items-center"},mt=["src"],_t={class:"instructorInfo d-flex flex-column justify-content-around align-items-center"},gt={class:"instrutorName"},pt={class:"instructorDes"},vt={class:"row justify-content-center m-4"},yt={class:"col"},ft=h(()=>t("h5",null,"查看路線",-1)),It={class:"panel",id:"floating-panel"},bt=h(()=>t("label",{for:"mode"},"交通方式： ",-1)),St=M('<option value="" selected disabled data-v-dfda23d7>選擇交通方式</option><option value="DRIVING" data-v-dfda23d7>開車</option><option value="WALKING" data-v-dfda23d7>走路</option><option value="BICYCLING" data-v-dfda23d7>腳踏車</option><option value="TRANSIT" data-v-dfda23d7>大眾運輸</option>',5),kt=[St],Ct=h(()=>t("div",{id:"map"},null,-1)),wt={class:"row justify-content-center m-4"},At={class:"col"},Dt=h(()=>t("h5",null,"問與答",-1)),Nt={key:0},qt=["qid"],Mt={key:0,class:"QAlist"},Tt={class:"question"},xt={class:"user d-flex align-items-center"},jt=["src"],Bt={key:1,class:"quser",src:b,alt:""},Qt={class:"ms-4"},Et={class:"qcontent"},Lt={class:"date"},Ot={key:0,class:"answer mt-3"},Pt={class:"acontent"},Rt={class:"date"},Vt={key:1,class:"myQAlist"},Gt={class:"myquestion"},Jt={class:"user d-flex align-items-center"},zt=["src"],Ut={key:1,class:"quser",src:b,alt:""},Ht={class:"ms-4"},Ft=["onClick"],Kt=h(()=>t("i",{class:"fa-solid fa-trash"},null,-1)),Wt=[Kt],Yt={class:"myqcontent"},Xt={class:"date"},Zt={key:0,class:"myanswer mt-3"},$t={class:"myacontent"},te={class:"date"},ee={class:"askInput d-flex mt-4"},se={key:1,"data-bs-toggle":"modal","data-bs-target":"#loginModal",class:"askBtn",id:"ask"},oe={class:"qerromsg"},ie={class:"row justify-content-center m-4"},ne={key:0,class:"col",id:"sameCategory"},le=h(()=>t("div",null,[t("h5",null,"同類型推薦")],-1)),ae={class:"row",id:"sameCategoryCard"},ce={class:"sameList"},re=["src"],de={class:"sameInfo"},he={class:"activityName"},ue={class:"samedate"},me=h(()=>t("i",{class:"fa-solid fa-calendar-days"},null,-1)),_e={class:"ellipsis"},ge={class:"image-container"},pe=h(()=>t("img",{src:T,alt:""},null,-1)),ve=[pe],ye={key:0};function fe(e,s,o,l,n,d){const g=C("router-link");return a(),c("div",j,[t("div",B,[_(t("div",null,[t("div",Q,[t("div",E,[t("img",{class:"coverImage",src:n.details.coverImage,alt:""},null,8,L)]),t("div",O,[t("p",P,r(n.details.activityName),1),t("p",null,"拍攝類型："+r(n.details.categoryName),1),t("p",null,"建議器材："+r(n.details.recommendation),1),t("p",null,"活動時間："+r(n.details.gatheringTime),1),t("p",null,[p(" 集合地點："),t("span",R,r(n.details.address),1)]),t("p",null," 活動名額："+r(n.details.memberLimit)+"人 || 剩餘"+r(n.details.memberLimit-n.details.numOfEnrolment)+"人 ",1),t("p",null,"報名截止日："+r(n.details.deadline),1),t("div",V,[this.saveStatus.statusId==2?(a(),c("button",G,z)):this.saveStatus.statusId==3&&this.memberId!=0?(a(),c("button",{key:1,onClick:s[0]||(s[0]=i=>d.save(i,this.saveStatus.activityId,this.memberId)),class:"saveBtn"},H)):this.saveStatus.statusId==3&&this.memberId==0?(a(),c("button",F,W)):this.saveStatus.statusId==4||this.saveStatus.statusId==5?(a(),c("button",{key:3,onClick:s[1]||(s[1]=i=>d.unsave(i,n.saveStatus.unSaveId)),type:"button",class:"unsaveBtn",deleteId:n.saveStatus.unSaveId},Z,8,Y)):u("",!0),this.enrollStatus.statusId==2?(a(),c("button",tt," 報名已截止 ")):this.enrollStatus.statusId==3?(a(),c("button",et," 已額滿 ")):this.enrollStatus.statusId==4&&this.memberId==0?(a(),c("button",st," 報名活動 ")):this.enrollStatus.statusId==4&&this.memberId!=0?(a(),c("button",{key:7,type:"button",class:"enrollBtn",onClick:s[2]||(s[2]=i=>d.enroll(i))}," 報名活動 ")):this.enrollStatus.statusId==5?(a(),c("button",{key:8,type:"button",class:"unenrollBtn",deleteId:this.enrollStatus.deleteId,onClick:s[3]||(s[3]=i=>d.unenroll(this.enrollStatus.deleteId))}," 取消報名（已報名） ",8,ot)):u("",!0)])])]),t("div",it,[t("div",nt,[lt,t("div",at,r(n.details.activityDescription),1)]),t("div",ct,[rt,t("div",dt,[t("div",ht,[t("div",ut,[t("img",{src:n.details.resumePhoto,alt:"",referrerpolicy:"no-referrer"},null,8,mt)]),t("div",_t,[t("p",gt,r(n.details.instructorName),1),t("p",pt,r(n.details.instructorDescription),1)])])])])]),t("div",vt,[t("div",yt,[ft,t("div",It,[bt,_(t("select",{"onUpdate:modelValue":s[4]||(s[4]=i=>n.map.selectedMode=i),id:"mode",class:"mode"},kt,512),[[w,n.map.selectedMode]]),_(t("input",{placeholder:"輸入出發地點...","onUpdate:modelValue":s[5]||(s[5]=i=>n.map.origin=i),type:"text",id:"origin",class:"origin",autocomplete:"off"},null,512),[[y,n.map.origin]]),t("button",{class:"geoBtn",onClick:s[6]||(s[6]=(...i)=>d.getLocation&&d.getLocation(...i)),id:"geo"}," 使用目前位置 ")]),_(t("div",{class:"routes"},r(n.routes),513),[[v,n.routes!=""]]),Ct])]),t("div",wt,[t("div",At,[Dt,n.QandA.length>0?(a(),c("div",Nt,[(a(!0),c(f,null,I(n.QandA,(i,m)=>(a(),c("div",{key:m,qid:n.QandA.QId,class:"QandA",id:"question"},[i.memberId!=this.memberId?(a(),c("div",Mt,[t("div",null,[t("div",Tt,[t("div",xt,[i.photoSticker?(a(),c("img",{key:0,class:"quser",src:i.photoSticker,alt:""},null,8,jt)):(a(),c("img",Bt)),t("p",Qt,r(i.nickName),1)]),t("div",Et,[t("p",null,r(i.qContent),1)]),t("div",Lt,r(i.qDateCreated),1)])]),i.aId!=null?(a(),c("div",Ot,[p(" 回覆 "),t("div",Pt,[t("p",null,r(i.aContent),1)]),t("div",Rt,r(i.aDateCreated),1)])):u("",!0)])):i.memberId==this.memberId?(a(),c("div",Vt,[t("div",null,[t("div",null,[t("div",Gt,[t("div",Jt,[i.photoSticker?(a(),c("img",{key:0,class:"quser",src:i.photoSticker,alt:""},null,8,zt)):(a(),c("img",Ut)),t("p",Ht,r(i.nickName),1),t("button",{onClick:Ie=>d.deleteQ(i.qId,m),class:"deleteQcontent"},Wt,8,Ft)]),t("div",Yt,[t("p",null,r(i.qContent),1)]),t("div",Xt,r(i.qDateCreated),1)])])]),i.aId!=null?(a(),c("div",Zt,[p(" 回覆 "),t("div",$t,[t("p",null,r(i.aContent),1)]),t("div",te,r(i.aDateCreated),1)])):u("",!0)])):u("",!0)],8,qt))),128))])):u("",!0),t("div",ee,[_(t("textarea",{"onUpdate:modelValue":s[7]||(s[7]=i=>n.askContent=i),onKeydown:s[8]||(s[8]=(...i)=>d.errmsg&&d.errmsg(...i)),name:"content",id:"askcontent",class:"askContent",maxlength:"300",placeholder:"提出和此活動有關的問題！"},null,544),[[y,n.askContent]]),this.memberId!=0?(a(),c("button",{key:0,onClick:s[9]||(s[9]=(...i)=>d.ask&&d.ask(...i)),class:"askBtn",id:"ask"}," 發問 ")):(a(),c("button",se," 發問 "))]),t("p",oe,r(n.qerromsg),1)])]),t("div",ie,[n.sameCategory.length>0?(a(),c("div",ne,[le,t("div",ae,[(a(!0),c(f,null,I(n.sameCategory,(i,m)=>(a(),c("div",{key:m,class:"col-12 col-md-6"},[A(g,{to:"/Activity/"+i.activityId,class:"sameLink"},{default:D(()=>[t("div",ce,[t("div",null,[t("img",{class:"sameImg",src:i.coverImage,alt:"活動封面圖"},null,8,re)]),t("div",de,[t("p",he,r(i.activityName),1),t("p",ue,[me,p(r(i.gatheringTime),1)]),t("p",_e,r(i.description.slice(0,8))+"...",1)])])]),_:2},1032,["to"])]))),128))])])):u("",!0)])],512),[[v,!n.isloading&&n.details.activityName!=null]]),_(t("div",ge,ve,512),[[v,n.isloading]]),!n.isloading&&n.details.activityName==null?(a(),c("div",ye,"沒有此活動")):u("",!0)])])}const Ce=S(x,[["render",fe],["__scopeId","data-v-dfda23d7"]]);export{Ce as default};
