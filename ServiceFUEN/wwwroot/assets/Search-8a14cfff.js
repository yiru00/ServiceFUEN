import{_ as k,u as C,r as w,o as d,c as u,b as a,w as h,v as g,I as N,B as _,F as f,l as b,y as I,C as y,t as m,a as S,m as T,H as A,z as D,A as M,q as x}from"./index-df9d28fa.js";import{_ as B}from"./Spinner-1s-200px-2-0335de7c.js";const E={mixins:[C],data(){return{input:{activityName:"",categoryId:0,address:"",time:new Date,memberId:0},result:[],minDate:new Date,categoryOption:[],isloading:!0,isempty:!0}},mounted(){this.getMemberId(),this.scrollToTop(),this.getCategory(),this.setTime(),this.fetchActivityData(),this.$nextTick(()=>{this.result.forEach(e=>{this.$el.querySelector(".addressTag").addEventListener("click",()=>{this.Citytag(e)})})}),this.$nextTick(()=>{this.result.forEach(e=>{this.$el.querySelector(".categoryTag").addEventListener("click",()=>{this.Categorytag(e)})})})},methods:{async fetchActivityData(){this.isloading=!0,this.isempty=!1;let e=await this.getMemberId(),t={activityName:this.input.activityName,categoryId:this.input.categoryId,address:this.input.address,time:this.input.time,memberId:e};console.log(t);let i="https://localhost:7259/api/Activity/Search?";t.activityName!==""&&(i+=`activityName=${t.activityName}&`),t.categoryId!==0&&(i+=`categoryId=${t.categoryId}&`),t.address!==""&&(i+=`address=${t.address}&`),i+=`time=${t.time}&`,i+=`memberId=${t.memberId}`,console.log(i),this.isempty=!1;const s=await(await fetch(i)).json();this.isloading=!1,this.result=s,s.length==0&&(this.isempty=!0)},setTime(){let e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),min:e.getMinutes()};t.month<10&&(t.month=`0${t.month}`),t.day<10&&(t.day=`0${t.day}`),t.hour<10&&(t.hour=`0${t.hour}`),t.min<10&&(t.min=`0${t.min}`);let i=`${t.year}-${t.month}-${t.day}T${t.hour}:${t.min}`;this.input.time=i,this.minDate=i},Citytag(e){this.input.address=e,this.input.activityName="",this.input.categoryId=0,this.setTime(),this.fetchActivityData()},Categorytag(e){this.input.address="",this.input.activityName="",this.input.categoryId=e,this.setTime(),this.fetchActivityData()},async getMemberId(){let e=0,i={method:"GET",headers:{Authorization:`Bearer ${$.cookie("token")}`}};try{let s=await(await fetch("https://localhost:7259/api/Members/Read",i)).json();return console.log(s),e=s,this.input.memberId=e,e}catch{return console.log("未登入"),this.input.memberId=e,e}},async getCategory(){let t=await(await fetch("https://localhost:7259/api/Activity/Category")).json();this.categoryOption=t},save(e,t,i,c){e.stopPropagation();let s;e.target.tagName.toLowerCase()==="button"?s=e.target:e.target.tagName.toLowerCase()==="i"&&(s=e.currentTarget),this.result[t].numOfCollections++,s.innerHTML=`<i style="width: 16px;
        color: #444;
        margin-right: 10px;"
        class="fa-solid fa-bookmark"></i>`,fetch("https://localhost:7259/api/ActivitySave/Save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memberId:c,activityId:i})}).then(l=>l.json()).then(l=>{console.log("Success:",l),l.result?(this.result[t].statusId=4,this.result[t].unSaveId=l.activityCollectionId,this.showAlert(l.message)):this.showAlert(l.message)}).catch(l=>{console.error("Error:",l)})},unsave(e,t,i){e.stopPropagation(),this.result[t].numOfCollections--;let c;e.target.tagName.toLowerCase()==="button"?c=e.target:e.target.tagName.toLowerCase()==="i"&&(c=e.currentTarget),c.innerHTML=`<i style="width: 16px;color: #444444;margin-right: 10px;" 
                                class="fa-regular fa-bookmark"></>`,fetch("https://localhost:7259/api/ActivitySave/UnSave/"+i,{method:"Delete"}).then(s=>s.json()).then(s=>{console.log("Success:",s),s.result?(this.result[t].statusId=3,this.result[t].unSaveId=0,this.showAlert(s.message)):this.showAlert(s.message)}).catch(s=>{console.error("Error:",s)})}}},r=e=>(D("data-v-976b699a"),e=e(),M(),e),L={class:"container"},O={class:"searchPage"},V={class:"row inputSearch"},j={class:"col-lg-3 col-md-4 col-12"},P={class:"col-lg-2 col-md-4 col-6"},q=r(()=>a("option",{value:"",disabled:""},"選擇拍攝類型",-1)),U=r(()=>a("option",{value:"0"},"所有拍攝類型",-1)),H=["value"],F={class:"col-lg-2 col-md-4 col-6"},z=x('<option disabled data-v-976b699a>選擇地區</option><option value="" selected data-v-976b699a>所有地區</option><option value="基隆市" data-v-976b699a>基隆市</option><option value="台北市" data-v-976b699a>台北市</option><option value="新北市" data-v-976b699a>新北市</option><option value="桃園市" data-v-976b699a>桃園市</option><option value="新竹市" data-v-976b699a>新竹市</option><option value="新竹縣" data-v-976b699a>新竹縣</option><option value="苗栗縣" data-v-976b699a>苗栗線</option><option value="台中市" data-v-976b699a>台中市</option><option value="彰化縣" data-v-976b699a>彰化縣</option><option value="南投縣" data-v-976b699a>南投縣</option><option value="雲林縣" data-v-976b699a>雲林縣</option><option value="嘉義市" data-v-976b699a>嘉義市</option><option value="嘉義縣" data-v-976b699a>嘉義縣</option><option value="台南市" data-v-976b699a>台南市</option><option value="高雄市" data-v-976b699a>高雄市</option><option value="屏東縣" data-v-976b699a>屏東縣</option><option value="宜蘭縣" data-v-976b699a>宜蘭縣</option><option value="花蓮縣" data-v-976b699a>花蓮縣</option><option value="台東縣" data-v-976b699a>台東縣</option><option value="澎湖縣" data-v-976b699a>澎湖縣</option><option value="金門縣" data-v-976b699a>金門縣</option><option value="連江縣" data-v-976b699a>連江縣</option>',24),K=[z],G={class:"col-lg-5 col-md-12 col-12"},J=["min"],R={class:"row",id:"resultCard"},Y=["activityId"],Q={class:"card-header"},W=["src"],X={class:"card-body"},Z=r(()=>a("i",{class:"fa-solid fa-calendar-days"},null,-1)),tt=r(()=>a("i",{class:"fa-solid fa-map-pin"},null,-1)),et=["onClick","city"],ot={class:"tag"},at=["onClick","categoryId"],st={class:"info"},it={class:"enroll"},nt=r(()=>a("i",{class:"fa-solid fa-user"},null,-1)),lt={class:"num"},ct={class:"save"},rt=["activityId"],dt=r(()=>a("i",{class:"fa-regular fa-bookmark"},null,-1)),ut=[dt],ht=["onClick"],mt=r(()=>a("i",{class:"fa-regular fa-bookmark"},null,-1)),pt=[mt],vt=["onClick"],yt=r(()=>a("i",{class:"fa-solid fa-bookmark"},null,-1)),gt=[yt],_t={class:"num"},ft={class:"nothingPage"},bt={class:"image-container"},It=r(()=>a("img",{src:B,alt:""},null,-1)),kt=[It];function Ct(e,t,i,c,s,n){const l=w("router-link");return d(),u("div",L,[a("div",O,[a("form",V,[a("div",j,[h(a("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.input.activityName=o),onKeydown:t[1]||(t[1]=N((...o)=>n.fetchActivityData&&n.fetchActivityData(...o),["enter"])),class:"inputName",name:"activityName",id:"activityName",type:"text",placeholder:"輸入活動名稱關鍵字...",autocomplete:"off"},null,544),[[g,s.input.activityName]])]),a("div",P,[h(a("select",{onChange:t[2]||(t[2]=(...o)=>n.fetchActivityData&&n.fetchActivityData(...o)),"onUpdate:modelValue":t[3]||(t[3]=o=>s.input.categoryId=o),class:"inputCategory",name:"categoryId",id:"categoryId"},[q,U,(d(!0),u(f,null,b(s.categoryOption,o=>(d(),u("option",{key:o.categoryName,value:o.id},m(o.categoryName),9,H))),128))],544),[[_,s.input.categoryId]])]),a("div",F,[h(a("select",{onChange:t[4]||(t[4]=(...o)=>n.fetchActivityData&&n.fetchActivityData(...o)),"onUpdate:modelValue":t[5]||(t[5]=o=>s.input.address=o),class:"inputAddress",name:"address",id:"adress"},K,544),[[_,s.input.address]])]),a("div",G,[h(a("input",{onChange:t[6]||(t[6]=(...o)=>n.fetchActivityData&&n.fetchActivityData(...o)),"onUpdate:modelValue":t[7]||(t[7]=o=>s.input.time=o),min:s.minDate,class:"inputTime",name:"time",type:"datetime-local",id:"inputTime"},null,40,J),[[g,s.input.time]]),I(" 之後的活動 ")])]),h(a("div",R,[(d(!0),u(f,null,b(s.result,(o,v)=>(d(),u("div",{key:v,class:"col-12 col-sm-6 col-md-4 col-xl-3"},[a("div",{class:"card",activityId:o.activityId},[a("div",Q,[S(l,{to:"/Activity/"+o.activityId},{default:T(()=>[a("img",{src:o.coverImage,alt:"cover"},null,8,W)]),_:2},1032,["to"])]),a("div",X,[a("h5",null,m(o.activityName),1),a("p",null,[Z,I(m(o.gatheringTime),1)]),a("p",null,[tt,a("a",{onClick:p=>n.Citytag(o.city),class:"addressTag",city:o.city},m(o.city),9,et)]),a("span",ot,[a("a",{onClick:p=>n.Categorytag(o.categoryId),class:"categoryTag",categoryId:o.categoryId},m(o.categoryName),9,at)])]),a("div",st,[a("div",it,[nt,a("p",lt,m(o.numOfEnrolment),1)]),a("div",ct,[this.input.memberId==0?(d(),u("button",{key:0,"data-bs-toggle":"modal","data-bs-target":"#loginModal",type:"button",class:"saveBtn1",activityId:o.activityId},ut,8,rt)):o.statusId==3&&this.input.memberId!=0?(d(),u("button",{key:1,onClick:p=>n.save(p,v,o.activityId,this.input.memberId),type:"button",class:"saveBtn"},pt,8,ht)):o.statusId==4&&this.input.memberId!=0?(d(),u("button",{key:2,onClick:p=>n.unsave(p,v,o.unSaveId),type:"button",class:"unsaveBtn"},gt,8,vt)):A("",!0),a("p",_t,m(o.numOfCollections),1)])])],8,Y)]))),128))],512),[[y,!s.isempty&&!s.isloading]]),h(a("div",ft,"找不到符合的資料",512),[[y,s.isempty]]),h(a("div",bt,kt,512),[[y,s.isloading]])])])}const St=k(E,[["render",Ct],["__scopeId","data-v-976b699a"]]);export{St as default};
